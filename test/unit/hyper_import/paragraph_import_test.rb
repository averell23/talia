require 'test/unit'

# Load the helper class
require File.join(File.dirname(__FILE__), 'util_helper')

# require util stuff
require 'talia_util'

module TaliaUtil

  class ParagraphImportTest < Test::Unit::TestCase
  
    include UtilTestMethods
    
    suppress_fixtures
    
    # Flush RDF before each test
    def setup
      flush_once_for_import_test
      setup_once(:paragraph) { hyper_import(load_doc('AC-17')) }
      setup_once(:coord_para) { hyper_import(load_doc('D-12,10r[1]')) }
      setup_once(:multinotes) { hyper_import(load_doc('Mp-XIV-2,55v[2]et56r[1]')) }
      setup_once(:work_para) { hyper_import(load_doc('WS-194')) }
    
    end
    
    # Special test - this one caused trouble during import
    def test_messed_up_note
      test_par = hyper_import(load_doc('D-12,3r[1]et4r[1]'))
      test_par.hyper::note.each do |note|
        puts note[N::HYPER.coordinates].values.join(', ')
      end
    end
    
    # Test if the import succeeds
    def test_import
      assert_kind_of(TaliaCore::Paragraph, @paragraph)
    end
    
    def test_siglum
      assert_equal('Mp-XIV-2,55v[2]et56r[1]', @multinotes.siglum)
    end
    
    # Test if the types were imported correctly
    def test_types
      assert_types(@paragraph, N::HYPER + "Paragraph", N::HYPER + "Work")
    end
    
    # Test source name
    def test_name
      assert_equal(N::LOCAL + "AC-17", @paragraph.uri)
    end
    
    # Test the manuscript paragraph
    def test_manuscript_para_title
      assert_property(@coord_para.dcns::title, "D 12,10r[1]")
    end
    
    # Test the note import for a paragraph
    def test_paragraph_notes
      notes = @coord_para.hyper::note
      assert_equal(1, notes.size)
      assert_kind_of(TaliaCore::Note, notes[0])
    end
    
    # Test if the properties of a paragraph were imported correctly
    def test_paragraph_notes_position
      note = @coord_para.hyper::note[0]
      assert_property(note.hyper::position, "000001")
    end
    
    
    # Test if the properties of a paragraph were imported correctly
    def test_paragraph_notes_page
      note = @paragraph.hyper::note[0]
      assert_property(note.hyper::page, N::LOCAL + "AC,[Text]")
    end

    # Test if the imported value arrives correctly at the "pages" accessor
    def test_paragraph_pages
      assert_equal(@paragraph.pages.collect { |p| p.uri }, [ N::LOCAL + "AC,[Text]" ])
    end
    
    # Test import of a paragraph with multiple notes
    def test_paragraph_multiple_notes
      notes = @multinotes.hyper::note
      assert_equal(2, notes.size)
      # Some little sanity checks
      assert_equal(1, notes[0].hyper::page.size)
      assert_equal(1, notes[1].hyper::page.size)
      assert_not_equal(notes[0].hyper::page[0], notes[1].hyper::page[0])
    end
    
    # Test work paragraph
    def test_work_paragrahph
      assert_types(@work_para, N::HYPER + "Paragraph", N::HYPER + "Work")
      assert_equal(2, @work_para.hyper::note.size)
    end
    
    # Assert auto create of new not positions
    def test_note_position_creation
      notes_pos = @work_para.hyper::note.collect {|note| note.hyper::position[0].to_i }
      assert_equal([194, 194].sort, notes_pos.sort)
    end
    
    # Test coordinates
    def test_coordinates
      assert_equal(@coord_para.hyper::note[0].coordinates, '57,35,57,36,56,36,56,36,55,36,54,36,53,36,52,36,52,36,51,36,50,36,49,36,48,36,48,36,47,36,46,36,45,36,45,35,44,35,44,35,43,35,42,35,41,35,40,35,40,35,39,35,38,36,37,36,37,36,36,36,36,37,35,37,34,37,34,37,33,37,33,38,31,38,31,39,31,40,30,40,30,40,29,40,29,41,29,41,28,42,27,42,27,44,26,44,26,44,25,44,25,45,25,46,25,47,24,47,24,48,24,48,23,49,23,50,22,50,22,51,22,52,21,53,21,54,21,55,21,56,21,56,21,57,20,57,20,58,20,59,20,60,20,60,20,61,20,62,20,63,20,64,19,64,19,64,19,65,19,66,19,67,19,67,19,68,18,69,18,70,18,71,17,71,17,72,17,73,17,74,17,75,17,75,17,77,17,78,17,79,17,79,17,80,17,81,17,82,17,83,17,83,17,84,17,85,17,86,17,87,17,87,17,88,17,89,17,90,17,91,17,92,17,93,17,94,17,94,17,95,17,96,17,97,17,98,17,98,17,99,17,100,17,101,17,102,17,102,17,103,17,104,17,105,17,105,17,106,17,106,17,107,17,108,17,109,17,110,17,110,17,111,16,113,16,114,16,114,16,115,16,116,16,117,16,118,16,118,16,119,16,120,16,121,16,121,16,122,16,123,16,124,16,125,16,125,16,127,16,128,16,129,16,129,16,130,16,131,16,132,16,133,16,134,16,136,16,137,17,137,17,137,17,138,17,139,17,140,17,141,17,141,17,142,17,144,17,145,17,145,17,146,17,147,17,148,17,148,17,150,17,151,17,152,17,152,17,153,17,154,17,155,17,156,17,156,17,157,17,158,17,159,17,160,17,160,17,161,17,162,17,163,17,164,16,164,16,165,16,166,16,167,16,168,16,169,16,170,16,171,16,172,16,172,16,173,16,174,16,175,16,176,17,178,17,179,17,179,17,180,17,180,17,181,17,182,17,183,17,183,17,184,17,185,17,186,17,187,17,187,17,188,17,189,17,190,17,191,17,191,17,192,17,193,17,194,17,195,17,196,17,197,17,198,17,199,17,200,17,201,17,202,17,202,17,204,17,205,17,206,17,207,17,209,17,210,17,210,17,211,17,212,17,213,17,214,17,214,17,216,17,218,17,219,17,220,17,221,17,222,17,222,17,223,17,224,17,225,17,226,17,226,17,227,17,228,17,229,17,231,17,232,17,233,17,235,17,236,17,237,17,238,16,239,16,241,16,241,16,242,16,243,16,245,17,245,17,245,17,247,17,248,17,249,17,249,17,250,16,252,16,253,16,255,16,256,15,256,15,256,15,257,15,258,15,259,15,260,15,260,15,261,15,262,15,263,14,264,14,264,13,265,13,266,13,267,13,268,13,268,13,269,13,270,13,271,12,272,12,272,11,273,11,274,11,275,11,276,11,276,11,277,10,277,10,278,10,279,10,280,10,280,9,281,9,283,8,283,8,283,8,284,8,285,8,286,8,287,8,287,8,288,8,289,8,290,8,291,8,291,8,292,8,293,8,294,8,295,8,295,8,296,8,297,8,298,8,299,8,299,8,300,8,301,8,302,8,303,8,303,8,304,9,304,9,305,9,306,9,307,9,307,9,309,9,310,9,310,9,311,9,312,9,313,9,314,9,314,10,315,10,316,10,317,10,318,10,318,10,318,10,319,10,320,10,322,11,322,11,322,11,323,11,324,11,325,11,326,11,326,11,327,11,328,11,329,11,330,11,330,11,331,11,332,11,333,11,334,11,335,11,336,11,337,11,337,11,338,11,339,11,340,11,341,11,341,11,342,11,343,11,345,11,345,11,347,12,348,12,349,12,349,12,351,12,352,13,352,13,353,13,353,13,354,13,355,13,356,13,357,13,357,13,357,14,357,14,358,15,358,16,358,17,359,17,359,17,360,18,360,19,360,20,361,21,361,21,361,22,361,23,361,24,361,25,361,25,361,26,361,27,361,28,361,29,361,30,361,31,361,33,361,33,361,34,361,35,360,36,360,37,360,38,360,39,360,40,360,41,360,42,360,43,360,44,360,45,360,46,360,47,360,48,360,48,360,49,360,50,360,51,360,52,361,52,361,53,361,54,361,55,361,56,361,56,361,57,361,58,361,59,361,60,361,60,361,61,361,62,361,63,361,64,361,64,361,65,361,66,362,67,362,67,362,68,362,69,362,70,362,71,362,72,362,74,362,75,362,77,362,79,362,80,362,82,363,83,363,84,363,86,363,88,363,90,363,91,363,92,363,93,363,94,363,95,363,96,363,98,363,98,364,100,364,101,364,102,364,104,364,105,364,106,364,108,363,109,363,110,363,110,363,111,363,112,363,113,363,114,363,115,363,116,363,117,362,118,362,118,362,119,362,120,362,121,362,121,362,123,362,124,362,125,362,126,362,127,362,129,363,129,363,131,363,133,363,134,363,136,363,137,363,139,363,140,363,141,362,142,362,143,362,145,362,145,362,147,361,148,361,148,361,149,361,150,361,151,361,152,361,152,361,153,361,154,361,156,361,156,360,157,360,158,360,159,360,160,360,160,360,161,360,162,359,163,359,164,359,164,358,165,358,166,358,167,358,168,358,168,358,169,358,170,358,171,358,172,358,172,357,173,357,174,357,175,357,176,356,177,356,178,355,179,355,179,354,180,354,182,354,183,354,183,354,184,354,185,353,187,353,187,353,188,353,189,353,191,353,193,353,195,353,199,353,201,353,203,352,205,352,207,352,209,352,211,351,213,351,215,351,217,351,218,351,219,351,221,351,222,351,222,351,223,351,224,351,224,352,225,352,226,352,226,353,227,353,228,353,229,353,229,353,230,353,231,353,232,353,233,353,233,353,234,353,236,353,237,353,239,353,240,353,241,353,242,353,243,353,244,353,245,353,246,353,247,353,248,353,249,353,249,353,251,353,252,353,253,353,253,353,254,353,255,353,256,353,256,353,257,353,259,353,260,353,260,354,261,354,263,354,264,354,264,356,265,356,266,356,267,356,268,356,268,356,269,356,271,357,272,357,272,357,273,358,274,358,275,358,276,358,276,358,278,358,279,358,280,358,280,358,281,358,282,358,283,358,283,358,285,358,287,358,287,357,288,357,289,357,290,357,291,357,291,357,292,357,292,356,293,356,294,356,295,356,295,356,296,356,297,356,298,355,299,355,299,355,300,355,301,355,302,355,303,355,303,355,304,355,305,355,306,355,307,355,308,355,309,355,310,355,310,355,312,355,313,355,314,354,315,354,317,354,318,354,319,354,321,354,322,354,323,354,325,353,326,353,326,353,327,353,329,353,330,353,330,353,331,353,332,353,333,353,334,353,334,353,335,353,335,352,336,352,336,351,336,350,337,349,337,349,337,348,338,348,338,347,339,347,339,346,339,345,339,345,339,344,340,344,340,343,340,342,340,341,340,341,340,340,340,339,340,338,340,337,340,337,340,336,340,335,340,334,340,334,340,333,340,331,340,330,340,330,340,329,340,328,340,327,340,326,340,326,340,325,340,324,340,323,340,322,340,322,340,321,340,320,340,319,340,318,340,318,340,316,339,315,339,314,339,314,339,312,339,311,339,310,339,310,338,308,338,307,338,306,338,305,338,303,338,303,338,302,338,301,338,300,338,299,338,299,338,298,338,297,338,296,338,295,338,294,338,293,338,292,338,291,338,291,338,290,338,289,338,288,338,287,338,287,338,286,338,285,339,285,339,284,339,283,339,283,339,282,340,280,340,280,340,279,340,278,341,277,341,276,341,276,341,275,341,274,341,273,341,272,341,272,341,272,341,271,341,270,342,270,342,269,342,268,342,268,343,268,343,267,343,266,344,265,344,264,345,264,345,263,345,262,345,262,345,261,345,260,346,260,346,259,346,258,347,258,347,257,347,256,347,256,348,256,348,255,348,254,348,253,348,253,348,252,348,251,348,250,348,249,348,249,348,248,348,247,348,246,348,245,348,245,348,243,349,243,349,242,349,241,349,241,349,240,349,239,349,238,349,237,349,237,349,236,349,235,349,234,349,233,349,232,349,232,349,230,349,229,349,229,348,229,348,228,348,227,348,226,348,226,347,225,347,224,347,223,346,223,346,222,346,222,346,221,346,220,346,219,346,218,346,216,346,215,347,215,347,214,347,214,347,213,347,211,348,211,348,210,348,210,348,209,348,208,348,207,348,206,348,206,348,205,348,204,348,203,348,202,348,202,348,201,348,200,348,199,349,199,349,197,349,196,349,195,349,195,349,194,349,193,349,192,349,192,349,191,349,190,350,189,350,188,350,187,350,187,350,186,350,185,350,184,350,183,350,183,350,182,350,181,350,180,350,179,350,178,350,176,349,176,349,175,349,175,349,174,349,173,349,172,349,172,349,171,349,171,349,170,349,169,349,168,349,168,349,167,349,166,349,165,349,164,349,164,349,163,349,162,349,161,349,160,349,160,349,159,349,158,349,157,350,157,350,156,350,156,350,155,350,154,350,153,350,152,350,152,350,151,350,150,350,148,350,147,350,146,350,145,350,144,350,143,350,142,350,141,350,141,350,140,350,139,350,138,350,137,350,137,350,136,350,135,350,134,350,133,349,133,349,132,349,131,349,130,349,130,349,129,349,129,349,128,349,127,349,126,348,125,348,125,348,124,348,123,348,122,348,121,348,121,348,120,348,119,348,118,347,118,347,118,347,117,347,116,348,115,348,114,348,114,348,113,348,112,348,111,348,110,348,109,348,107,348,106,348,106,348,105,348,104,348,103,348,102,348,102,348,101,348,100,348,99,348,98,348,98,348,97,348,95,348,94,348,94,348,93,348,92,348,91,348,91,349,90,349,89,349,88,349,87,349,87,349,86,349,85,349,84,349,83,348,83,348,82,348,81,347,80,347,79,347,78,347,77,346,77,346,76,346,75,346,75,346,74,346,73,346,72,346,71,347,71,347,70,347,69,347,68,347,67,347,67,347,66,347,65,347,64,347,63,347,62,347,61,348,60,348,60,348,59,348,58,348,57,348,56,348,55,348,54,348,53,348,52,349,52,349,51,349,50,349,49,349,48,348,48,348,48,348,46,348,45,348,44,347,44,347,43,346,42,346,41,346,40,346,40,345,39,345,38,345,38,345,37,344,37,343,37,342,37,341,37,341,37,340,37,338,37,337,37,337,37,336,37,335,37,334,37,334,37,333,37,332,37,331,37,330,37,330,37,329,37,328,37,327,37,326,37,326,37,325,37,324,37,323,37,322,37,322,37,321,38,319,38,318,38,318,38,317,39,316,39,315,40,314,40,314,40,313,40,312,41,311,41,310,41,310,41,310,42,309,42,308,42,308,43,307,43,307,43,307,44,306,44,305,44,305,44,304,44,303,44,303,44,303,45,302,45,301,45,300,45,299,45,299,45,298,45,297,45,296,45,295,45,295,44,295,44,294,44,293,44,293,44,292,44,291,44,291,43,290,43,290,42,289,42,288,42,287,41,287,41,286,40,285,40,285,40,284,40,284,39,283,39,283,38,282,38,281,38,280,38,280,37,280,37,279,37,277,37,276,37,276,37,275,37,273,37,272,37,272,37,271,37,270,37,269,37,268,38,268,38,267,38,266,38,265,38,264,38,263,38,262,38,261,38,260,38,260,38,259,38,258,38,257,38,256,38,256,38,255,38,254,38,253,38,253,38,252,38,251,37,250,37,249,37,249,37,248,37,247,36,245,36,245,35,243,35,242,35,241,35,239,35,238,35,237,35,236,34,235,34,234,33,233,33,232,33,230,33,229,33,229,33,228,33,227,32,226,32,225,32,223,31,222,31,220,31,218,30,216,30,214,30,213,30,211,29,210,29,208,29,207,29,206,29,204,29,202,28,200,28,199,28,196,28,195,28,194,28,193,28,191,28,191,28,190,28,189,28,188,28,187,28,187,28,186,28,186,29,185,29,184,29,183,29,183,29,182,29,181,29,180,29,179,29,179,30,178,30,177,30,176,30,175,30,175,30,174,30,172,31,172,31,170,32,168,32,167,33,166,33,164,33,164,33,162,33,161,33,160,33,160,33,159,33,157,33,156,33,156,33,155,33,154,33,153,33,152,33,152,33,151,33,150,33,149,33,148,33,148,33,147,33,146,33,145,33,145,33,144,33,142,33,141,33,141,33,140,33,139,33,138,33,137,33,136,33,135,33,133,35,133,35,132,35,131,35,129,35,128,35,127,35,126,35,125,35,125,35,123,35,122,35,121,35,121,35,119,35,118,36,118,36,117,36,116,36,115,36,114,36,113,36,112,37,111,37,110,37,110,37,109,37,108,37,107,37,106,37,105,37,103,37,102,37,102,37,101,38,100,38,99,38,98,38,97,38,96,38,94,38,93,39,91,39,91,39,90,39,89,39,88,39,87,39,87,39,86,39,85,39,84,39,83,38,83,38,82,38,81,38,80,38,80,37,79,37,78,37,77,37,76,37,75,37,75,37,74,37,73,37,72,37,71,37,70,37,69,37,68,37,67,37,67,37,66,37,65,37,64,37,64,37,63,37,62,37,61,37,60,38')
    end
    
  end
end
